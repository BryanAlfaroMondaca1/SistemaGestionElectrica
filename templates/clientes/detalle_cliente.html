{% extends 'base.html' %}

{% block title %}Detalle de Cliente{% endblock %}
{% block page_title %}Detalle de Cliente{% endblock %}
{% block content %}
<div class="contenedor-formulario mt-4">
    <div class="tarjeta-formulario w-100" style="max-width:800px;">
        <div class="encabezado-formulario d-flex align-items-center justify-content-between" style="padding: 18px 25px;">
            <h2 class="mb-0 fs-4">
                <i class="fas fa-user me-2"></i> Detalle de Cliente
            </h2>
            <a href="{% url 'sistemaGestion:lista_clientes' %}" class="btn btn-sm btn-outline-secondary">
                <i class="fas fa-arrow-left me-1"></i> Volver a Lista
            </a>
        </div>
        {% if messages %}
            {% for message in messages %}
                <div class="alert alert-info py-2 px-3 mb-3">{{ message }}</div>
            {% endfor %}
        {% endif %}
        <div class="cuerpo-formulario">
            <table class="table table-bordered table-striped mb-4">
                <tbody>
                    <tr>
                        <th class="w-50">N¬∞ Cliente</th>
                        <td>{{ cliente.numero_cliente }}</td>
                    </tr>
                    <tr>
                        <th>Nombre Completo</th>
                        <td>{{ cliente.nombre }}</td>
                    </tr>
                    <tr>
                        <th>Correo Electr√≥nico</th>
                        <td>
                            <a href="mailto:{{ cliente.email }}">{{ cliente.email }}</a>
                        </td>
                    </tr>
                    <tr>
                        <th>Tel√©fono</th>
                        <td>
                            <a href="tel:{{ cliente.telefono }}">{{ cliente.telefono }}</a>
                        </td>
                    </tr>
                </tbody>
            </table>

            <!-- ‚úÖ SECCI√ìN DE RELACIONES - NUEVO -->
            <div class="mt-4 p-3 border rounded">
                <h5 class="mb-3">
                    <i class="fas fa-link me-2"></i>Relaciones del Cliente
                </h5>
                
                <!-- Relaci√≥n 1: Cliente ‚Üí Usuario -->
                <div class="mb-3 p-3 border rounded bg-light">
                    <h6 class="mb-2">üë§ Usuario Responsable</h6>
                    {% if usuario_responsable %}
                        <p class="mb-1"><strong>Username:</strong> {{ usuario_responsable.username }}</p>
                        <p class="mb-1"><strong>Rol:</strong> {{ usuario_responsable.rol }}</p>
                        <p class="mb-0"><strong>Email:</strong> {{ usuario_responsable.email }}</p>
                    {% else %}
                        <p class="text-warning mb-0">‚ö†Ô∏è No tiene usuario asociado</p>
                    {% endif %}
                </div>

                <!-- Relaci√≥n 2: Cliente ‚Üí Medidores -->
                <div class="mb-3 p-3 border rounded bg-light">
                    <h6 class="mb-2">üìü Medidores Asociados ({{ medidores_cliente|length }})</h6>
                    {% if medidores_cliente %}
                        {% for medidor in medidores_cliente %}
                        <div class="d-flex justify-content-between align-items-center py-1 px-2 mb-1 bg-white rounded">
                            <span><strong>{{ medidor.numero_medidor }}</strong> - {{ medidor.ubicacion }}</span>
                            <span class="badge {% if medidor.estado_medidor == 'Activo' %}bg-success{% else %}bg-warning{% endif %}">
                                {{ medidor.estado_medidor }}
                            </span>
                        </div>
                        {% endfor %}
                    {% else %}
                        <p class="text-warning mb-0">‚ö†Ô∏è No tiene medidores asociados</p>
                    {% endif %}
                </div>

                <!-- Relaci√≥n 3: Cliente ‚Üí Contratos -->
                <div class="mb-3 p-3 border rounded bg-light">
                    <h6 class="mb-2">üìÑ Contratos ({{ contratos_cliente|length }})</h6>
                    {% if contratos_cliente %}
                        {% for contrato in contratos_cliente %}
                        <div class="d-flex justify-content-between align-items-center py-1 px-2 mb-1 bg-white rounded">
                            <span><strong>{{ contrato.numero_contrato }}</strong></span>
                            <span class="badge {% if contrato.estado == 'Activo' %}bg-success{% else %}bg-secondary{% endif %}">
                                {{ contrato.estado }}
                            </span>
                        </div>
                        {% endfor %}
                    {% else %}
                        <p class="text-warning mb-0">‚ö†Ô∏è No tiene contratos asociados</p>
                    {% endif %}
                </div>

                <!-- Relaci√≥n 4: Cliente ‚Üí Boletas -->
                <div class="mb-3 p-3 border rounded bg-light">
                    <h6 class="mb-2">üßæ Boletas ({{ boletas_cliente|length }})</h6>
                    {% if boletas_cliente %}
                        {% for boleta in boletas_cliente %}
                        <div class="d-flex justify-content-between align-items-center py-1 px-2 mb-1 bg-white rounded">
                            <span>
                                <strong>${{ boleta.monto_total }}</strong> - 
                                {{ boleta.fecha_emision }}
                            </span>
                            <span class="badge 
                                {% if boleta.estado == 'Pagado' %}bg-success
                                {% elif boleta.estado == 'Pendiente' %}bg-warning
                                {% else %}bg-danger{% endif %}">
                                {{ boleta.estado }}
                            </span>
                        </div>
                        {% endfor %}
                    {% else %}
                        <p class="text-warning mb-0">‚ö†Ô∏è No tiene boletas asociadas</p>
                    {% endif %}
                </div>
            </div>
            <!-- FIN SECCI√ìN RELACIONES -->

            <div class="d-flex gap-2 mt-4">
                <a href="{% url 'sistemaGestion:editar_cliente' cliente.id %}" class="btn btn-sm btn-outline-secondary">
                    <i class="fas fa-edit me-1"></i> Editar Cliente
                </a>
                <a href="{% url 'sistemaGestion:eliminar_cliente' cliente.id %}" class="btn btn-sm btn-outline-secondary">
                    <i class="fas fa-trash-alt me-1"></i> Eliminar Cliente
                </a>
            </div>
        </div>
    </div>
</div>
{% endblock %}